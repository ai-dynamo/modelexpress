# SPDX-FileCopyrightText: Copyright (c) 2025-2026 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0

# Values for testing gRPC file transfer without shared storage (no PVC)
# This configuration uses emptyDir volumes instead of PersistentVolumeClaims,
# which means the server and client have isolated storage and must transfer
# files via gRPC streaming.

replicaCount: 1

image:
  repository: modelexpress
  pullPolicy: IfNotPresent
  tag: "test"

# No image pull secrets needed for local testing
imagePullSecrets: []

serviceAccount:
  create: true
  annotations: {}

podAnnotations: {}

podLabels: {}

# Disable security context for local testing - allow running as root
podSecurityContext: {}

securityContext:
  runAsNonRoot: false

service:
  type: ClusterIP
  port: 8001

ingress:
  enabled: false

# Minimal resources for testing
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 256Mi

# Disable PVC-based persistence - use emptyDir instead
persistence:
  enabled: false

# Use emptyDir for ephemeral storage (server-side cache)
extraVolumes:
  - name: model-cache
    emptyDir:
      sizeLimit: 2Gi

extraVolumeMounts:
  - name: model-cache
    mountPath: /root

env:
  MODEL_EXPRESS_SERVER_PORT: "8001"
  MODEL_EXPRESS_LOG_LEVEL: "debug"
  MODEL_EXPRESS_DATABASE_PATH: "/tmp/models.db"
  MODEL_EXPRESS_CACHE_DIRECTORY: "/root"
  # Note: HOME is set to /root so HuggingFace cache uses /root/.cache/huggingface
  HOME: "/root"
  # Disable Redis - use a port that will get immediate connection refused
  REDIS_URL: "redis://127.0.0.1:1"

livenessProbe:
  enabled: true
  tcpSocket:
    port: 8001
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  enabled: true
  tcpSocket:
    port: 8001
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

nodeSelector: {}

tolerations: []

affinity: {}

extraEnv: []

args: []

command: []
